var Services;!function(a){var e=function(){function a(a,e,o){this.$resource=a,this.$rootScope=e,this.orderByFilter=o,this.isRequired=!0,this.predicate=["-points","-sumGoals","-goalsScored"],this.modelChanged=!1}return a.prototype.loadModel=function(a){var e=this;this.$resource("../Bet/GetBasisForBet/"+a).get(function(a){e.groups=a.groups,e.initializeGroupsForBet(),e.initializePlayoffGamesForBet(a.playoffGames),e.$rootScope.$broadcast("modelLoaded",!0)})},a.prototype.scoreChanged=function(a,e){isNaN(e.homeGoals)||isNaN(e.awayGoals)||(this.updateTeamsInGroup(a),this.setWinnerAndRunnerUpInGroup(a),this.setPlayoffGameTeams(a,!0),this.modelChanged=!0,this.clearMessages())},a.prototype.setPlayoffGameTeams=function(e,o){var s=this,t=!0;angular.forEach(e.games,function(a){null!=a.homeGoals&&null!=a.awayGoals||(t=!1)}),t&&angular.forEach(this.playoffGames,function(a){a.id===e.winnerGameCode&&(a.homeTeam=e.winner),a.id===e.runnerUpGameCode&&(a.awayTeam=e.runnerUp),o&&s.playoffGameScoreChanged(a)})},a.prototype.updateTeamsInGroup=function(a){var s=this;angular.forEach(a.teams,function(o){o=s.clearTeamValues(o),angular.forEach(a.games,function(a){var e;null!=a.homeGoals&&null!=a.awayGoals&&(a.homeTeam.id===o.id&&(o.goalsScored+=a.homeGoals,o.goalsConceded+=a.awayGoals,e=s.setPointsForGame(a.homeGoals,a.awayGoals),o.points+=s.setPointsForGame(a.homeGoals,a.awayGoals),3===e&&o.gamesWonAgainstTeams.push(a.awayTeam)),a.awayTeam.id===o.id&&(o.goalsScored+=a.awayGoals,o.goalsConceded+=a.homeGoals,e=s.setPointsForGame(a.awayGoals,a.homeGoals),o.points+=e,3===e&&o.gamesWonAgainstTeams.push(a.homeTeam)))}),o.sumGoals=o.goalsScored-o.goalsConceded})},a.prototype.clearTeamValues=function(a){return a.goalsScored=0,a.goalsConceded=0,a.points=0,a.sumGoals=0,a.gamesWonAgainstTeams=[],a},a.prototype.setPointsForGame=function(a,e){return e<a?3:a<e?0:a===e?1:0},a.prototype.initializeGroupsForBet=function(){var e=this;angular.forEach(this.groups,function(a){angular.forEach(a.teams,function(a){a.goalsConceded=0,a.goalsScored=0,a.points=0,a.sumGoals=0}),e.updateTeamsInGroup(a),angular.forEach(a.games,function(e){angular.forEach(e.teamGames,function(a){a.isHomeTeam?e.homeTeam=a.team:e.awayTeam=a.team})})})},a.prototype.initializePlayoffGamesForBet=function(a){angular.forEach(a,function(a){a.playoffGameDetails=a.playoffGameDetails[0]}),this.playoffGames=a},a.prototype.setWinnerAndRunnerUpInGroup=function(a){return a.teams=this.orderTeamsBestFirst(a.teams),a.winner=a.teams[0],a.runnerUp=a.teams[1],a},a.prototype.orderTeamsBestFirst=function(a){var e=this.orderByFilter(a,this.predicate,!1);return this.teamsAreEqualByPredicate(e,0,1)&&(this.swapTeamsByGamesWonAgainstEachother(e,0,1),this.teamsAreEqualByPredicate(e,1,2)&&(this.swapTeamsByGamesWonAgainstEachother(e,1,2),this.teamsAreEqualByPredicate(e,2,3)&&this.swapTeamsByGamesWonAgainstEachother(e,2,3))),e},a.prototype.clearMessages=function(){this.errorMessage="",this.successMessage=""},a.prototype.playoffGameScoreChanged=function(a){if(!a.homeGoals&&!a.awayGoals){var e,o,s;if(null!=a.playoffGameDetails.nextPlayoffGame){if(null==(o=this.getWinnerOfGame(a)))return;e=a.playoffGameDetails.isHomeTeamNextGame,s=a.playoffGameDetails.nextPlayoffGame,this.setNextPlayoffGame(s,o,e)}if(null!=a.playoffGameDetails.nextPlayoffGameRunnerUp){if(null==(o=this.getRunnerUpOfGame(a)))return;e=a.playoffGameDetails.isHomeTeamInRunnerUpGame,s=a.playoffGameDetails.nextPlayoffGameRunnerUp,this.setNextPlayoffGame(s,o,e)}this.modelChanged=!0,this.clearMessages()}},a.prototype.setNextPlayoffGame=function(e,o,s){var t=!1;angular.forEach(this.playoffGames,function(a){t||a.id===e&&(s?a.homeTeam=o:a.awayTeam=o,t=!0)})},a.prototype.getWinnerOfGame=function(a){return a.homeGoals>a.awayGoals?a.homeTeam:a.awayGoals>a.homeGoals?a.awayTeam:null},a.prototype.getRunnerUpOfGame=function(a){return a.homeGoals<a.awayGoals?a.homeTeam:a.awayTeam},a.prototype.setTeamScore=function(a,e,o){a.goalsScored+=o.homeGoals,a.goalsConceded+=o.awayGoals;var s=this.setPointsForGame(o.homeGoals,o.awayGoals);a.points+=this.setPointsForGame(o.homeGoals,o.awayGoals),3===s&&a.gamesWonAgainstTeams.push(o.awayTeam)},a.prototype.validateIfUserBetIsComplete=function(){var e=0;return angular.forEach(this.groups,function(a){angular.forEach(a.games,function(a){(isNaN(a.homeGoals)||isNaN(a.awayGoals))&&e++})}),angular.forEach(this.playoffGames,function(a){(isNaN(a.homeGoals)||isNaN(a.awayGoals))&&e++}),e},a.prototype.teamsAreEqualByPredicate=function(a,e,o){return a[e].points===a[o].points&&a[e].sumGoals===a[o].sumGoals&&a[e].goalsScored===a[o].goalsScored},a.prototype.swapTeamsByGamesWonAgainstEachother=function(a,e,o){if(this.isInArray(a[e].id,a[o].gamesWonAgainstTeams)){var s=a[e];a[e]=a[o],a[o]=s}},a.prototype.isInArray=function(a,e){return-1<e.indexOf(a)},a.$inject=["$resource","$rootScope","orderByFilter"],a}();a.BetBaseController=e}(Services||(Services={}));
var Services;!function(e){"use strict";var t=function(){function e(e){this.$http=e}return e.prototype.getLeaderboard=function(){return this.$http({method:"POST",url:"../Leaderboard/GetOverallLeaderboardBySportsEventId"}).then(function(e){return e.data})},e.prototype.getLeaderboardForLeague=function(e){return this.$http({method:"POST",url:"../Leaderboard/GetLeaderboardByLeagueId",data:{leagueId:e}}).then(function(e){return e.data})},e.$inject=["$http"],e}();e.LeaderboardService=t}(Services||(Services={}));
var Services;!function(e){"use strict";var t=function(){function e(e){this.$http=e}return e.prototype.getLeagues=function(){return this.$http({method:"GET",url:"GetLeaguesForUser"}).then(function(e){return e.data})},e.prototype.joinLeague=function(e){return this.$http({method:"POST",url:"AddCurrentUserToLeagueByGuid",data:{guid:e}}).then(function(e){var t=e.data,r={};return t.ExceptionMessage&&(r.message=t.ExceptionMessage,r.isError=!0),r})},e.prototype.addCurrentUserToLeague=function(e){return this.$http({method:"POST",url:"AddCurrentUserToLeague",data:{leagueName:e}}).then(function(e){var t=e.data,r={};return t.ExceptionMessage?(r.message=t.ExceptionMessage,r.isError=!0):(r.message="KODE FOR Å BLI MED I LIGA: "+t,r.isError=!1),r})},e.prototype.addNewLeague=function(e){return this.$http({method:"POST",url:"AddNewLeague",data:{leagueName:e}}).then(function(e){var t=e.data,r={};return t.ExceptionMessage?(r.message=t.ExceptionMessage,r.isError=!0):(r.message="KODE FOR Å BLI MED I LIGA: "+t,r.isError=!1),r})},e.$inject=["$http"],e}();e.LeagueService=t}(Services||(Services={}));
var Services;!function(t){"use strict";var e=function(){function t(t){this.$http=t}return t.prototype.saveBet=function(t,e){var a=this.extractGroupResultFromGroups(t),r=this.extractPlayoffGamesResultFromPlayoffGames(e);return this.$http({method:"POST",url:"../Bet/SavePersonBet",data:{groupGamesResult:a,playoffGamesResult:r}}).then(function(t){return t.data})},t.prototype.saveBetResult=function(t,e){var a=this.extractGroupResultFromGroups(t),r=this.extractPlayoffGamesResultFromPlayoffGames(e);return this.$http({method:"POST",url:"../Result/SaveResultBets",data:{groupGamesResult:a,playoffGamesResult:r}}).then(function(t){return t.data})},t.prototype.extractGroupResultFromGroups=function(t){var e=[];return angular.forEach(t,function(t){angular.forEach(t.games,function(t){null==t.homeGoals&&null==t.awayGoals||e.push(t)})}),angular.toJson(e)},t.prototype.extractPlayoffGamesResultFromPlayoffGames=function(t){var e=[];return angular.forEach(t,function(t){null==t.homeTeam&&null==t.awayTeam||e.push(t)}),angular.toJson(e)},t.$inject=["$http"],t}();t.BetService=e}(Services||(Services={}));
var Services;!function(t){"use strict";var e=function(){function t(t){this.$http=t}return t.prototype.getUsers=function(){return this.$http({method:"GET",url:"../User/GetUsers"}).then(function(t){return t.data})},t.$inject=["$http"],t}();t.UserBetService=e}(Services||(Services={}));
var Services;!function(t){"use strict";var e=function(){function t(t){this.$http=t}return t.prototype.getPreviousGames=function(t){return this.$http({method:"POST",url:"../TodaysGames/GetPreviousGames",data:{daysFromToday:t}}).then(function(t){return null==t.ExceptionMessage&&t.data})},t.prototype.getNextGames=function(t){return this.$http({method:"POST",url:"../TodaysGames/GetNextGames",data:{daysFromToday:t}}).then(function(t){return null!=t.data.ExceptionMessage?null:t.data})},t.$inject=["$http"],t}();t.TodaysGamesService=e}(Services||(Services={}));
var MainApp;!function(e){"use strict";angular.module("footballCompApp",["ngResource"]).service("betBaseController",Services.BetBaseController).service("betService",Services.BetService).service("userBetService",Services.UserBetService).service("resultPageService",Services.ResultPageService).service("leaderboardService",Services.LeaderboardService).service("todaysGamesService",Services.TodaysGamesService).service("leagueService",Services.LeagueService)}(MainApp||(MainApp={}));
var Controllers;!function(e){"use strict";var t=function(){function e(e,t,o,r){var s=this;this.$scope=e,this.$window=t,this.betBaseController=o,this.betService=r,this.numberOfIncompleteGames=0,this.betBaseController.loadModel(""),this.$scope.$on("modelLoaded",function(){s.initializeGroupsAndPlayoffGames(),s.setLabelForUserBetComplete()})}return e.prototype.initializeGroupsAndPlayoffGames=function(){var t=this;angular.forEach(this.betBaseController.groups,function(e){t.betBaseController.setWinnerAndRunnerUpInGroup(e)})},e.prototype.setLabelForUserBetComplete=function(){this.numberOfIncompleteGames=this.betBaseController.validateIfUserBetIsComplete(),0<this.numberOfIncompleteGames&&this.numberOfIncompleteGames<64?this.userBetIncompleteMessage="(Ditt spill er ikke komplett!)":this.userBetIncompleteMessage=""},e.prototype.save=function(){var t=this;this.betBaseController.modelChanged=!1,this.numberOfIncompleteGames=this.betBaseController.validateIfUserBetIsComplete(),64!==this.numberOfIncompleteGames?this.betService.saveBet(this.betBaseController.groups,this.betBaseController.playoffGames).then(function(e){t.betBaseController.clearMessages(),t.setLabelForUserBetComplete(),null!=e.ExceptionMessage?(t.betBaseController.modelChanged=!0,t.betBaseController.errorMessage=e.ExceptionMessage):0===t.numberOfIncompleteGames?t.betBaseController.successMessage=e:t.betBaseController.errorMessage="Ditt spill er lagret, men du mangler noen resultater. Husk å fyll inn disse før VM starter!"}):this.betBaseController.errorMessage="Fyll inn resultater!"},e.$inject=["$scope","$window","betBaseController","betService"],e}();e.BetController=t}(Controllers||(Controllers={})),angular.module("footballCompApp").controller("BetController",Controllers.BetController);
var Controllers;!function(e){"use strict";var r=function(){function e(e,r,o){var t=this;this.$scope=e,this.$rootScope=r,this.leaderboardService=o,this.headerText="",this.numberOfIncompleteGames=0,this.$rootScope.$on("showLeagueEvent",function(e,r){t.getLeaderboardForLeague(r.id),t.headerText="Stilling for "+r.name})}return e.prototype.getLeaderboard=function(){var r=this;this.leaderboardService.getLeaderboard().then(function(e){r.leaderboard=e})},e.prototype.getLeaderboardForLeague=function(e){var r=this;this.leaderboardService.getLeaderboardForLeague(e).then(function(e){r.leaderboard=e})},e.$inject=["$scope","$rootScope","leaderboardService"],e}();e.LeaderboardController=r}(Controllers||(Controllers={})),angular.module("footballCompApp").controller("LeaderboardController",Controllers.LeaderboardController);
var Controllers;!function(e){"use strict";var s=function(){function e(e,s,o){this.$scope=e,this.$rootScope=s,this.leagueService=o,this.loadLeagues()}return e.prototype.loadLeagues=function(){var s=this;this.leagueService.getLeagues().then(function(e){s.leagues=e,s.showLeague(e[0])})},e.prototype.joinLeague=function(){var s=this;this.leagueService.joinLeague(this.leagueCode).then(function(e){e.isError?(s.message=e.message,s.messageClass="error"):s.loadLeagues()})},e.prototype.addCurrentUserToLeague=function(){var s=this;this.leagueService.addCurrentUserToLeague(this.leagueName).then(function(e){s.message=e.message,e.isError?s.messageClass="error":(s.messageClass="success",s.loadLeagues())})},e.prototype.addNewLeague=function(){var s=this;if(""===this.leagueName)return this.message="Liganavn kan ikke være tomt",void(this.messageClass="error");this.leagueService.addNewLeague(this.leagueName).then(function(e){e.isError?s.messageClass="error":(s.messageClass="success",s.message=e.message,s.loadLeagues())})},e.prototype.showLeague=function(e){this.$rootScope.$broadcast("showLeagueEvent",e)},e.$inject=["$scope","$rootScope","leagueService"],e}();e.LeagueController=s}(Controllers||(Controllers={})),angular.module("footballCompApp").controller("LeagueController",Controllers.LeagueController);
var Controllers;!function(e){"use strict";var t=function(){function e(e,t,o){var r=this;this.$scope=e,this.betBaseController=t,this.betService=o,this.betBaseController.isRequired=!1,this.betBaseController.loadModel(""),e.$on("modelLoaded",function(){r.userBetControllerInit()})}return e.prototype.saveResultBets=function(){var t=this;this.betService.saveBetResult(this.betBaseController.groups,this.betBaseController.playoffGames).then(function(e){t.message=e})},e.prototype.initializeGroupsAndPlayoffGames=function(){var t=this;angular.forEach(this.betBaseController.groups,function(e){t.betBaseController.setWinnerAndRunnerUpInGroup(e)})},e.prototype.userBetControllerInit=function(){this.initializeGroupsAndPlayoffGames()},e.$inject=["$scope","betBaseController","betService"],e}();e.ResultController=t}(Controllers||(Controllers={})),angular.module("footballCompApp").controller("ResultController",Controllers.ResultController);
var Controllers;!function(t){"use strict";var e=function(){function t(t,e){this.$scope=t,this.todaysGamesService=e,this.todaysDate=new Date,this.daysFromNow=0,this.loadTodaysGames()}return t.prototype.nextDay=function(){this.nextButtonDisabled||(this.daysFromNow++,this.getNextGames())},t.prototype.previousDay=function(){this.previousButtonDisabled||(this.daysFromNow--,this.getPreviousGames())},t.prototype.loadTodaysGames=function(){var e=this;this.nextButtonDisabled=!0,this.previousButtonDisabled=!0,this.todaysGamesService.getNextGames(this.daysFromNow).then(function(t){t.isFirstDay||(e.previousButtonDisabled=!0),e.nextButtonDisabled=e.isNextButtonDisabled(),e.todaysGames=t.todaysGamesSpecification,e.daysFromNow+=t.numberOfDaysFromToday,e.loaded=!0})},t.prototype.getNextGames=function(){var e=this;this.nextButtonDisabled=!0,this.todaysGamesService.getNextGames(this.daysFromNow).then(function(t){e.previousButtonDisabled=!1,e.todaysGames=t.todaysGamesSpecification,e.daysFromNow+=t.numberOfDaysFromToday,e.todaysDate=e.getTodaysDatePlusDays(e.daysFromNow),e.nextButtonDisabled=e.isNextButtonDisabled()})},t.prototype.getPreviousGames=function(){var e=this;this.previousButtonDisabled=!0,this.todaysGamesService.getPreviousGames(this.daysFromNow).then(function(t){e.nextButtonDisabled=!1,e.todaysGames=t.todaysGamesSpecification,e.daysFromNow+=t.numberOfDaysFromToday,e.todaysDate=e.getTodaysDatePlusDays(e.daysFromNow),e.previousButtonDisabled=e.isPreviousButtonDisabled()})},t.prototype.isNextButtonDisabled=function(){var t=new Date(2018,6,15);return this.todaysDate.getTime()>=t.getTime()},t.prototype.isPreviousButtonDisabled=function(){var t=new Date(2018,5,14);return this.todaysDate<t},t.prototype.getTodaysDatePlusDays=function(t){return(new Date).addDays(t)},t.$inject=["$scope","todaysGamesService"],t}();t.TodaysGamesController=e}(Controllers||(Controllers={})),angular.module("footballCompApp").controller("TodaysGamesController",Controllers.TodaysGamesController),Date.prototype.addDays=function(t){var e=new Date(this.valueOf());return e.setDate(e.getDate()+t),e};
var Controllers;!function(e){"use strict";var t=function(){function e(e,t,r,o){var s=this;this.$scope=e,this.$location=t,this.betBaseController=r,this.userBetService=o,this.showSearch=!0,r.isRequired=!1,this.loadByLocation(),e.$on("modelLoaded",function(){s.userBetControllerInit()})}return e.prototype.loadByLocation=function(){var t=this,e=this.$location.absUrl().split("username=")[1];e?(this.showSearch=!1,this.selectedUserName=e,this.betBaseController.loadModel(e),this.showUserBet=!0):this.userBetService.getUsers().then(function(e){t.users=e})},e.prototype.searchUserBet=function(t){var r=this;this.showUserBet=!1,angular.forEach(this.users,function(e){e.userName===t&&(r.betBaseController.loadModel(e.userName),r.errorMessage="",r.showUserBet=!0)}),this.showUserBet||(this.errorMessage="Fant ikke bruker, vennligst søk med fullstendig brukernavn")},e.prototype.initializeGroupsAndPlayoffGames=function(){var t=this;angular.forEach(this.betBaseController.groups,function(e){t.betBaseController.setWinnerAndRunnerUpInGroup(e)})},e.prototype.userBetControllerInit=function(){this.initializeGroupsAndPlayoffGames()},e.$inject=["$scope","$location","betBaseController","userBetService"],e}();e.UserBetController=t}(Controllers||(Controllers={})),angular.module("footballCompApp").controller("UserBetController",Controllers.UserBetController);
var Controllers;!function(e){"use strict";var o=function(){function e(e,o,t,r){var l=this;this.$scope=e,this.$rootScope=o,this.betBaseController=t,this.resultPageService=r,e.$on("modelLoaded",function(){l.resultPageControllerInit()}),this.loadResult()}return e.prototype.loadResult=function(){var o=this;this.resultPageService.loadResult().then(function(e){o.betBaseController.groups=e.groups,o.betBaseController.initializeGroupsForBet(),o.betBaseController.initializePlayoffGamesForBet(e.playoffGames),o.$rootScope.$broadcast("modelLoaded",!0)})},e.prototype.initializeGroupsAndPlayoffGames=function(){var o=this;angular.forEach(this.betBaseController.groups,function(e){o.betBaseController.setWinnerAndRunnerUpInGroup(e),o.betBaseController.setPlayoffGameTeams(e,!1)})},e.prototype.resultPageControllerInit=function(){this.initializeGroupsAndPlayoffGames()},e.$inject=["$scope","$rootScope","betBaseController","resultPageService"],e}();e.ResultPageController=o}(Controllers||(Controllers={})),angular.module("footballCompApp").controller("ResultPageController",Controllers.ResultPageController);
